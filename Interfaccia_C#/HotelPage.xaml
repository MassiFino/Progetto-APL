<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Interfaccia_C_.HotelPage"
             x:Name="HotelPageViewRoot"
             Title="Dettagli Hotel"
             BackgroundColor="AliceBlue"
             Padding="0">

    <ScrollView>
        <VerticalStackLayout Padding="10">
            <!-- Nome dell'hotel -->
            <Label Text="{Binding Name}" 
                   FontSize="24" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center" 
                   TextColor="Black"/>
                <!-- CarouselView per visualizzare una sola immagine alla volta -->
            <CarouselView ItemsSource="{Binding ImageList}" HeightRequest="400" WidthRequest="400">
                <CarouselView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal" ItemSpacing="10" />
                </CarouselView.ItemsLayout>
                <CarouselView.ItemTemplate>
                    <DataTemplate>
                        <!-- Usa un Grid che riempie lo spazio disponibile -->
                        <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                            <Image Source="{Binding .}" 
               Aspect="AspectFit"
               HorizontalOptions="Center"
               VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>



            <!-- Descrizione dell'hotel -->
            <Label Text="Descrizione" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>
            <Label Text="{Binding Description}" 
                   FontSize="14" 
                   LineBreakMode="WordWrap"
                   HorizontalOptions="Start" 
                   TextColor="Black" />

            <!-- Location dell'hotel -->
            <Label Text="{Binding Location}" 
                   FontSize="16"
                   HorizontalOptions="Start" 
                   TextColor="Black"/>
            <!-- Services dell'hotel -->
            <Label Text="Servizi offerti dall'hotel" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>

            <Label Text="{Binding Services}" 
           FontSize="16"
           HorizontalOptions="Start" 
           TextColor="Black"/>
            <!-- Rating dell'hotel -->
            <Label Text="Valutazione" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>
            <Label Text="{Binding Rating}" 
                   FontSize="16"
                   HorizontalOptions="Start" 
                   TextColor="Black"/>
            <!-- Sezione Disponibilità -->
            <Label Text="Stanze disponibili" FontSize="Medium" FontAttributes="Bold" TextColor="Black" HorizontalOptions="Center"/>

            <Border Stroke="DarkOrange" StrokeThickness="1" BackgroundColor="LightGreen" Padding="20"
       HorizontalOptions="Center" VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="30" />
                </Border.StrokeShape>

                <!-- Layout contenitore per i DatePicker -->
                <VerticalStackLayout Spacing="20" HorizontalOptions="Center" VerticalOptions="Center">
                    <!-- DatePicker per il check-in -->
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                        <DatePicker Date="{Binding CheckInDate}" Format="dd/MM/yyyy" WidthRequest="150" HeightRequest="40"/>
                        <DatePicker Date="{Binding CheckOutDate}" Format="dd/MM/yyyy" WidthRequest="150" HeightRequest="40"/>
                        <!-- Bottone per la ricerca: abilitato solo se IsSearchEnabled è true -->
                        <Button Text="Cerca stanza" 
                            Command="{Binding CercaStanzaCommand}"
                            IsEnabled="{Binding IsSearchEnabled}"
                            WidthRequest="200" HeightRequest="30"/>
                    </HorizontalStackLayout>

                    <!-- Label che mostra il messaggio di errore se SearchErrorMessage non è vuoto -->
                    <Label Text="{Binding SearchErrorMessage}" 
                        FontSize="14" 
                        TextColor="Red"
                        HorizontalOptions="Center" />
                    
                    <Label Text="Nessuna stanza è disponibile per tale data" 
                        FontSize="16" 
                        HorizontalOptions="Center"
                        TextColor="Red"
                        IsVisible="{Binding NoRoomsAvailable}" />

                    <!-- Aggiungi CollectionView per visualizzare le stanze -->
                    <CollectionView ItemsSource="{Binding Rooms}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="DarkOrange" StrokeThickness="1" BackgroundColor="LightYellow" Padding="10"
                            HorizontalOptions="Center" VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="30" />
                                    </Border.StrokeShape>

                                    <HorizontalStackLayout Spacing="10">
                                        <Frame HasShadow="False" BackgroundColor="Transparent" BorderColor="Transparent"
                                   CornerRadius="20" Padding="0" HeightRequest="150" WidthRequest="150">
                                            <Image Source="{Binding ImageSource}" Aspect="AspectFill" WidthRequest="150" HeightRequest="150"
                                       VerticalOptions="CenterAndExpand" />
                                        </Frame>

                                        <VerticalStackLayout>
                                            <Label Text="{Binding RoomName}" FontAttributes="Bold" FontSize="16" TextColor="Black" />
                                            <Label Text="{Binding RoomDescription}" MaxLines="3" FontSize="14" TextColor="Black" />
                                            <Label Text="Prezzo per notte:" FontAttributes="Bold" FontSize="14" TextColor="Black" />
                                            <Label Text="{Binding PricePerNight}" FontSize="12" TextColor="Black" />
                                            <Button Text="Prenota stanza" WidthRequest="200" HeightRequest="30"
                                                FontSize="14" Padding="5" HorizontalOptions="Start"
                                                Command="{Binding Source={x:Reference HotelPageViewRoot}, Path=BindingContext.PrenotaStanzaCommand}"
                                                CommandParameter="{Binding .}"
                                                IsVisible="{Binding Source={x:Reference HotelPageViewRoot}, Path=BindingContext.IsSearchMode}"
                                                IsEnabled="{Binding CanBook}"/>
                                        </VerticalStackLayout>
                                    </HorizontalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>



            <!-- Recensioni degli ospiti -->
            <Label Text="Recensioni degli ospiti" FontSize="Medium" FontAttributes="Bold" TextColor="Black" HorizontalOptions="Center"/>
            <Border Stroke="DarkOrange" StrokeThickness="1" BackgroundColor="DarkOrange" Padding="10" 
              HorizontalOptions="Center" VerticalOptions="Center"
              StrokeShape="RoundRectangle 30">
                <!-- CollectionView per le recensioni -->
                <CollectionView ItemsSource="{Binding Reviews}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Stroke="DarkOrange" StrokeThickness="1" BackgroundColor="LightSalmon" Padding="10" 
                                HorizontalOptions="Center" VerticalOptions="Center"
                                StrokeShape="RoundRectangle 30">
                                <StackLayout Padding="10">
                                    <!-- Nome del recensore -->
                                    <Label Text="{Binding ReviewerName}" FontAttributes="Bold" FontSize="16"/>

                                    <!-- Sezione dettagli recensione, visibile solo se IsReviewSectionVisible è true -->
                                    <StackLayout IsVisible="{Binding IsReviewSectionVisible}" Spacing="5" Padding="5">
                                        <Label Text="Data Recensione:" FontAttributes="Bold" FontSize="14" TextColor="Black"/>
                                        <Label Text="{Binding CreatedAt}" FontSize="12" TextColor="Black"/>
                                        <Label Text="Commento:" FontAttributes="Bold" FontSize="14" TextColor="Black"/>
                                        <!-- Usa il binding a Comment se è il campo corretto -->
                                        <Label Text="{Binding Comment}" FontSize="12" TextColor="Black"/>
                                        <Label Text="Voto:" FontAttributes="Bold" FontSize="14" TextColor="Black"/>
                                        <Label Text="{Binding Rating}" FontSize="12" TextColor="Black"/>
                                    </StackLayout>
                                </StackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
